{% extends "layout.html" %}

{% block title %}Admin Dashboard - Campus Event Management{% endblock %}

{% block content %}
  <!-- Admin Dashboard Header -->
  <div class="admin-dashboard-header">
    <div class="container">
      <h1 class="display-5 fw-bold">Admin Dashboard</h1>
      <p class="lead">Manage users, clubs, and monitor platform activity</p>
    </div>
  </div>
  
  <div class="container py-5">
    <!-- Stats Overview -->
    <div class="row mb-4">
      <div class="col-md-3 mb-3">
        <div class="card shadow-sm stats-card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h6 class="text-muted mb-1">Total Users</h6>
                <h2 class="mb-0">{{ total_users }}</h2>
              </div>
              <div class="rounded-circle bg-primary bg-opacity-10 p-3">
                <i class="fas fa-users fa-2x text-primary"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-3 mb-3">
        <div class="card shadow-sm stats-card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h6 class="text-muted mb-1">Total Events</h6>
                <h2 class="mb-0">{{ total_events }}</h2>
              </div>
              <div class="rounded-circle bg-primary bg-opacity-10 p-3">
                <i class="fas fa-calendar-alt fa-2x text-primary"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-3 mb-3">
        <div class="card shadow-sm stats-card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h6 class="text-muted mb-1">Total Clubs</h6>
                <h2 class="mb-0">{{ total_clubs }}</h2>
              </div>
              <div class="rounded-circle bg-primary bg-opacity-10 p-3">
                <i class="fas fa-university fa-2x text-primary"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-3 mb-3">
        <div class="card shadow-sm stats-card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h6 class="text-muted mb-1">Registrations</h6>
                <h2 class="mb-0">{{ total_registrations }}</h2>
              </div>
              <div class="rounded-circle bg-primary bg-opacity-10 p-3">
                <i class="fas fa-ticket-alt fa-2x text-primary"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="row">
      <!-- Charts Column -->
      <div class="col-lg-8 mb-4">
        <!-- Charts -->
        <div class="card shadow-sm mb-4">
          <div class="card-header">
            <h4 class="mb-0">Analytics</h4>
          </div>
          <div class="card-body">
            <div class="row">
              <!-- User Roles Chart -->
              <div class="col-md-6 mb-4">
                <h5 class="text-center mb-3">User Roles Distribution</h5>
                <canvas id="user-roles-chart" height="250" 
                  data-labels='{{ ["Admin", "Organizer", "Student"]|tojson }}'
                  data-values='{{ [user_roles["Admin"], user_roles["Organizer"], user_roles["Student"]]|tojson }}'>
                </canvas>
              </div>
              
              <!-- Events Timeline -->
              <div class="col-md-6 mb-4">
                <h5 class="text-center mb-3">Recent Events</h5>
                <canvas id="event-timeline-chart" height="250"
                  data-labels='{{ ["Jan", "Feb", "Mar", "Apr", "May", "Jun"]|tojson }}'
                  data-values='{{ [5, 8, 12, 10, 15, 20]|tojson }}'>
                </canvas>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Recent Events -->
        <div class="card shadow-sm">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="mb-0">Recent Events</h4>
            <a href="{{ url_for('events_list') }}" class="btn btn-sm btn-outline-primary">View All</a>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Event Name</th>
                    <th>Organizer</th>
                    <th>Date</th>
                    <th>Registrations</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for event in recent_events %}
                    <tr>
                      <td>
                        <a href="{{ url_for('event_detail', event_id=event.id) }}" class="text-decoration-none">
                          {{ event.title }}
                        </a>
                      </td>
                      <td>{{ event.organizer.get_full_name() }}</td>
                      <td>{{ event.start_time|format_datetime('%b %d, %Y') }}</td>
                      <td>{{ event.get_registration_count() }}</td>
                      <td>
                        <a href="{{ url_for('event_detail', event_id=event.id) }}" class="btn btn-sm btn-outline-primary">
                          <i class="fas fa-eye"></i>
                        </a>
                        <a href="{{ url_for('edit_event', event_id=event.id) }}" class="btn btn-sm btn-outline-secondary">
                          <i class="fas fa-edit"></i>
                        </a>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Right Column -->
      <div class="col-lg-4">
        <!-- Quick Actions -->
        <div class="card shadow-sm mb-4">
          <div class="card-header">
            <h4 class="mb-0">Quick Actions</h4>
          </div>
          <div class="card-body">
            <div class="d-grid gap-2">
              <a href="{{ url_for('admin_users') }}" class="btn btn-outline-primary">
                <i class="fas fa-users me-2"></i> Manage Users
              </a>
              <a href="{{ url_for('admin_clubs') }}" class="btn btn-outline-primary">
                <i class="fas fa-university me-2"></i> Manage Clubs
              </a>
              <a href="{{ url_for('create_event') }}" class="btn btn-outline-primary">
                <i class="fas fa-calendar-plus me-2"></i> Create Event
              </a>
              <a href="{{ url_for('events_list') }}" class="btn btn-outline-primary">
                <i class="fas fa-calendar-alt me-2"></i> View All Events
              </a>
            </div>
          </div>
        </div>
        
        <!-- Recent Users -->
        <div class="card shadow-sm">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="mb-0">Recent Users</h4>
            <a href="{{ url_for('admin_users') }}" class="btn btn-sm btn-outline-primary">View All</a>
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              {% for user in recent_users %}
                <li class="list-group-item d-flex align-items-center">
                  {% if user.profile_picture %}
                    <img src="{{ url_for('static', filename=user.profile_picture) }}" class="rounded-circle me-3" width="40" height="40" alt="{{ user.get_full_name() }}">
                  {% else %}
                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                      {{ user.first_name[0] }}{{ user.last_name[0] }}
                    </div>
                  {% endif %}
                  <div class="flex-grow-1">
                    <h6 class="mb-0">{{ user.get_full_name() }}</h6>
                    <small class="text-muted">{{ user.email }}</small>
                  </div>
                  <span class="badge bg-{{ 'primary' if user.is_admin() else 'success' if user.is_organizer() else 'secondary' }}">
                    {{ user.role }}
                  </span>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/chart.js') }}"></script>
{% endblock %}
