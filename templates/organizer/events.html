{% extends "layout.html" %}

{% block title %}My Events - Organizer Dashboard{% endblock %}

{% block content %}
  <div class="container py-5">
    <div class="row mb-4">
      <div class="col-md-8">
        <h1 class="mb-3">My Events</h1>
        <p class="text-muted">Manage the events you are organizing</p>
      </div>
      <div class="col-md-4 text-md-end">
        <a href="{{ url_for('create_event') }}" class="btn btn-primary">
          <i class="fas fa-plus me-1"></i> Create New Event
        </a>
        <a href="{{ url_for('organizer_dashboard') }}" class="btn btn-outline-secondary ms-2">
          <i class="fas fa-arrow-left me-1"></i> Back
        </a>
      </div>
    </div>
    
    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" id="eventTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming" 
          type="button" role="tab" aria-controls="upcoming" aria-selected="true">
          Upcoming Events
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="ongoing-tab" data-bs-toggle="tab" data-bs-target="#ongoing" 
          type="button" role="tab" aria-controls="ongoing" aria-selected="false">
          Ongoing Events
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="past-tab" data-bs-toggle="tab" data-bs-target="#past" 
          type="button" role="tab" aria-controls="past" aria-selected="false">
          Past Events
        </button>
      </li>
    </ul>
    
    <div class="tab-content" id="eventTabsContent">
      <!-- Upcoming Events Tab -->
      <div class="tab-pane fade show active" id="upcoming" role="tabpanel" aria-labelledby="upcoming-tab">
        <div class="card shadow-sm">
          <div class="card-body">
            {% set upcoming_events = events|selectattr('is_upcoming')|list %}
            {% if upcoming_events %}
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Event Name</th>
                      <th>Date</th>
                      <th>Location</th>
                      <th>Registrations</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for event in upcoming_events %}
                      <tr>
                        <td>
                          <a href="{{ url_for('event_detail', event_id=event.id) }}" class="text-decoration-none">
                            {{ event.title }}
                          </a>
                        </td>
                        <td>{{ event.start_time|format_datetime('%b %d, %Y %I:%M %p') }}</td>
                        <td>{{ event.location }}</td>
                        <td>{{ event.get_registration_count() }}{% if event.max_participants %}/{{ event.max_participants }}{% endif %}</td>
                        <td>
                          <div class="btn-group" role="group">
                            <a href="{{ url_for('event_detail', event_id=event.id) }}" class="btn btn-sm btn-outline-primary" title="View Details">
                              <i class="fas fa-eye"></i>
                            </a>
                            <a href="{{ url_for('edit_event', event_id=event.id) }}" class="btn btn-sm btn-outline-secondary" title="Edit Event">
                              <i class="fas fa-edit"></i>
                            </a>
                            <a href="{{ url_for('event_check_in', event_id=event.id) }}" class="btn btn-sm btn-outline-success" title="Check-in">
                              <i class="fas fa-clipboard-check"></i>
                            </a>
                            <button type="button" class="btn btn-sm btn-outline-danger" title="Delete Event"
                              data-bs-toggle="modal" data-bs-target="#deleteEventModal{{ event.id }}">
                              <i class="fas fa-trash-alt"></i>
                            </button>
                          </div>
                          
                          <!-- Delete Event Modal -->
                          <div class="modal fade" id="deleteEventModal{{ event.id }}" tabindex="-1" aria-labelledby="deleteEventModalLabel{{ event.id }}" aria-hidden="true">
                            <div class="modal-dialog">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="deleteEventModalLabel{{ event.id }}">Confirm Delete</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                  <p>Are you sure you want to delete this event? This action cannot be undone.</p>
                                  <p class="fw-bold">{{ event.title }}</p>
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                  <form action="{{ url_for('delete_event', event_id=event.id) }}" method="post">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="submit" class="btn btn-danger">Delete Event</button>
                                  </form>
                                </div>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i> You don't have any upcoming events.
                <a href="{{ url_for('create_event') }}" class="alert-link">Create one now</a>.
              </div>
            {% endif %}
          </div>
        </div>
      </div>
      
      <!-- Ongoing Events Tab -->
      <div class="tab-pane fade" id="ongoing" role="tabpanel" aria-labelledby="ongoing-tab">
        <div class="card shadow-sm">
          <div class="card-body">
            {% set ongoing_events = events|selectattr('is_ongoing')|list %}
            {% if ongoing_events %}
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Event Name</th>
                      <th>Start Time</th>
                      <th>End Time</th>
                      <th>Location</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for event in ongoing_events %}
                      <tr>
                        <td>
                          <a href="{{ url_for('event_detail', event_id=event.id) }}" class="text-decoration-none">
                            {{ event.title }}
                          </a>
                        </td>
                        <td>{{ event.start_time|format_datetime('%b %d, %Y %I:%M %p') }}</td>
                        <td>{{ event.end_time|format_datetime('%b %d, %Y %I:%M %p') }}</td>
                        <td>{{ event.location }}</td>
                        <td>
                          <div class="btn-group" role="group">
                            <a href="{{ url_for('event_detail', event_id=event.id) }}" class="btn btn-sm btn-outline-primary" title="View Details">
                              <i class="fas fa-eye"></i>
                            </a>
                            <a href="{{ url_for('event_check_in', event_id=event.id) }}" class="btn btn-sm btn-outline-success" title="Check-in">
                              <i class="fas fa-clipboard-check"></i>
                            </a>
                          </div>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i> You don't have any ongoing events.
              </div>
            {% endif %}
          </div>
        </div>
      </div>
      
      <!-- Past Events Tab -->
      <div class="tab-pane fade" id="past" role="tabpanel" aria-labelledby="past-tab">
        <div class="card shadow-sm">
          <div class="card-body">
            {% set past_events = events|selectattr('is_past')|list %}
            {% if past_events %}
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Event Name</th>
                      <th>Date</th>
                      <th>Location</th>
                      <th>Attendance</th>
                      <th>Rating</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for event in past_events %}
                      <tr>
                        <td>
                          <a href="{{ url_for('event_detail', event_id=event.id) }}" class="text-decoration-none">
                            {{ event.title }}
                          </a>
                        </td>
                        <td>{{ event.start_time|format_datetime('%b %d, %Y') }}</td>
                        <td>{{ event.location }}</td>
                        <td>{{ event.get_attendance_count() }}/{{ event.get_registration_count() }}</td>
                        <td>
                          <div class="rating-stars">
                            {% set avg_rating = event.get_average_rating() %}
                            {% for i in range(1, 6) %}
                              <i class="fas fa-star {% if i <= avg_rating %}text-warning{% else %}text-secondary{% endif %}"></i>
                            {% endfor %}
                            <span class="ms-1">{{ avg_rating|round(1) }}</span>
                          </div>
                        </td>
                        <td>
                          <div class="btn-group" role="group">
                            <a href="{{ url_for('event_detail', event_id=event.id) }}" class="btn btn-sm btn-outline-primary" title="View Details">
                              <i class="fas fa-eye"></i>
                            </a>
                          </div>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i> You don't have any past events.
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
